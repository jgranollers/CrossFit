<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Competicions - Competition</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="/css/styles.css" rel="stylesheet">
</head>
<body>
    <div class="d-flex">
        <!-- Sidebar -->
        <aside class="sidebar col-auto">
            <div class="sidebar-title">
                <i class="fas fa-dumbbell"></i>
                PateixFit
            </div>

            <nav class="sidebar-section">
                <a href="/competiciones" class="sidebar-link active">
                    <i class="fas fa-trophy"></i> Competicions
                </a>
                <a href="/concursants" class="sidebar-link">
                    <i class="fas fa-users"></i> Concursants
                </a>
                <a href="/resultats" class="sidebar-link">
                    <i class="fas fa-chart-bar"></i> Resultat Competicions
                </a>
                <a th:if="${isAdmin}" href="/usuaris" class="sidebar-link">
                    <i class="fas fa-shield-alt"></i> Gestió Usuaris
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content flex-grow-1">
            <!-- Top Bar -->
            <div class="top-bar mb-4">
                <div class="search-box">
                    <input type="text" placeholder="Buscar">
                    <button type="submit"><i class="fas fa-search"></i></button>
                </div>

                <div class="profile-section">
                    <img th:if="${currentUserNacionalitat != null and !currentUserNacionalitat.isEmpty()}"
                         th:src="'https://flagcdn.com/24x18/' + ${#strings.toLowerCase(currentUserNacionalitat)} + '.png'"
                         th:alt="${currentUserNacionalitat}" width="28" height="21"
                         style="border-radius: 2px; vertical-align: middle; box-shadow: 0 1px 3px rgba(0,0,0,0.4);">
                    <a href="/perfil" class="avatar" title="Anar al perfil" style="display:flex;align-items:center;justify-content:center;text-decoration:none;overflow:hidden;">
                        <img th:if="${currentUserFoto != null}" th:src="${currentUserFoto}" alt="Foto" style="width:100%;height:100%;object-fit:cover;border-radius:50%;">
                        <i th:unless="${currentUserFoto != null}" class="fas fa-user" style="font-size:1.2rem; color: var(--accent-green);"></i>
                    </a>
                </div>
            </div>

            <!-- Page Header -->
            <div class="page-header">
                <h1 class="page-title">Competicions</h1>
            </div>

            <!-- Cards Grid -->
            <div class="cards-container">
                <!-- Card para crear nueva competición (solo admin) -->
                <a th:if="${isAdmin}" href="/competiciones/nuevo" class="card card-add-new" style="text-decoration: none; cursor: pointer;">
                    <div class="card-add-content">
                        <i class="fas fa-plus card-add-icon"></i>
                        <h3 class="card-add-title">Nova Competició</h3>
                    </div>
                </a>

                <!-- Competiciones desde la BD -->
                <div th:each="comp : ${competiciones}" class="card">
                    <div class="card-header">
                        <h3 class="card-title" th:text="${comp.nom}">NOM COMPETICIÓ</h3>
                        <span class="card-badge badge-green" th:text="${comp.estat}">OBERTA</span>
                    </div>
                    <div class="card-content">
                        <div class="info-item">
                            <i class="fas fa-calendar"></i>
                            <div>
                                <div class="info-label">Data</div>
                                <div class="info-value" th:text="${#temporals.format(comp.dataCompeticio, 'dd/MM/yyyy')}">31/01/2026</div>
                            </div>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-layer-group"></i>
                            <div>
                                <div class="info-label">Tipus</div>
                                <div class="info-value" th:text="${comp.tipusCompeticio}">Individual</div>
                            </div>
                        </div>
                        <div class="price-section">
                            <div>
                                <div class="info-label">Preu</div>
                                <div class="price" th:text="${comp.preuInscripcio == null or comp.preuInscripcio == 0 ? 'Gratis' : '€ ' + comp.preuInscripcio}">€ 10</div>
                            </div>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-map-marker-alt"></i>
                            <div>
                                <div class="info-label">Ubicació</div>
                                <div class="info-value" th:text="${comp.localitat ?: '?'}">Ubicació</div>
                            </div>
                        </div>
                        <div>
                            <div class="places-bar">
                                <div class="places-fill" th:style="'width: ' + ${porcentajesOcupacion[comp.id]} + '%;'"></div>
                            </div>
                            <div class="places-text">
                                <span th:text="${inscritos[comp.id]}">0</span> / <span th:text="${comp.maxParticipants}">0</span> PLACES OCUPADES
                            </div>
                        </div>
                    </div>
                    <div class="card-footer">
                        <a th:href="@{'/competiciones/' + ${comp.id}}" class="btn btn-primary">Veure detalls</a>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script src="/js/main.js"></script>
</body>
</html>
